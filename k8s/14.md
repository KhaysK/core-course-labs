# Kube Prometheus Stack

## The Kube Prometheus Stack simplifies the deployment of the entire Prometheus system within a Kubernetes cluster. It comprises essential elements

### Prometheus: This core element collects metrics from various agents (exporters) and stores them in its internal time-series database

### Alertmanager: Crucial for managing alerts and notifications generated by Prometheus. It processes alerts, eliminates duplicates, and sends notifications to different platforms like email, Slack, or PagerDuty

### Grafana: This graphical interface enables diverse visualization and dashboard options for the metrics gathered by Prometheus. Users can create and customize dashboards for an intuitive monitoring and analysis experience

### Kubernetes-specific Exporters: These specialized agents gather metrics from different Kubernetes components and resources, exposing them through HTTP endpoints for Prometheus to collect. Examples include kube-state-metrics

---

## Output of `kubectl get po,sts,svc,pvc,cm`

### List of pods

``` bash
NAME                                                         READY   STATUS    RESTARTS     AGE
pod/alertmanager-khays-lab14-kube-prometheu-alertmanager-0   2/2     Running   0            5m42s   
pod/khays-deployment-0                                       1/1     Running   2 (5m ago)   9d
pod/khays-deployment-1                                       1/1     Running   2 (5m ago)   9d
pod/khays-lab14-grafana-55f6979b86-mn7j2                     3/3     Running   0            6m24s
pod/khays-lab14-kube-prometheu-operator-5658fbf98-pdj2x      1/1     Running   0            6m24s
pod/khays-lab14-kube-state-metrics-66d848d8b5-k7czl          1/1     Running   0            6m24s
pod/khays-lab14-prometheus-node-exporter-s44jj               1/1     Running   0            6m24s
pod/prometheus-khays-lab14-kube-prometheu-prometheus-0       2/2     Running   0            5m42s
pod/vault-0                                                  1/1     Running   3 (2d ago)   16d
```

### List of statefulsets

``` bash
NAME                                                                    READY   AGE
statefulset.apps/alertmanager-khays-lab14-kube-prometheu-alertmanager   1/1     5m42s
statefulset.apps/khays-deployment                                       2/2     5h45m
statefulset.apps/prometheus-khays-lab14-kube-prometheu-prometheus       1/1     5m42s
statefulset.apps/vault                                                  1/1     14d
```

### List if services

``` bash
NAME                                              TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   5m42s
service/khays-deployment                          LoadBalancer   10.102.36.143    <pending>     5000:31618/TCP               9d
service/khays-lab14-grafana                       ClusterIP      10.102.31.120    <none>        80/TCP                       6m24s
service/khays-lab14-kube-prometheu-alertmanager   ClusterIP      10.99.100.174    <none>        9093/TCP,8080/TCP            6m24s
service/khays-lab14-kube-prometheu-operator       ClusterIP      10.96.172.51     <none>        443/TCP                      6m24s
service/khays-lab14-kube-prometheu-prometheus     ClusterIP      10.100.109.211   <none>        9090/TCP,8080/TCP            6m24s
service/khays-lab14-kube-state-metrics            ClusterIP      10.106.35.49     <none>        8080/TCP                     6m24s
service/khays-lab14-prometheus-node-exporter      ClusterIP      10.108.107.72    <none>        9100/TCP                     6m24s
service/kubernetes                                ClusterIP      10.96.0.1        <none>        443/TCP                      16d
service/prometheus-operated                       ClusterIP      None             <none>        9090/TCP                     5m42s
```

### List of persistence storages

``` bash
NAME                                         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/counter-khays-deployment-0   Bound    pvc-4ea43ed5-947c-4dfd-941d-f32022879b03   10Mi       RWO            standard       25h
persistentvolumeclaim/counter-khays-deployment-1   Bound    pvc-2a8cfc07-2563-4d6e-96b1-9e67e190d8d5   10Mi       RWO            standard       22h
```

### List of configmaps

``` bash
NAME                                                                     DATA   AGE
configmap/config-map                                                     1      8h12m
configmap/khays-lab14-grafana                                            1      6m24s
configmap/khays-lab14-grafana-config-dashboards                          1      6m24s
configmap/khays-lab14-kube-prometheu-alertmanager-overview               1      6m24s
configmap/khays-lab14-kube-prometheu-apiserver                           1      6m24s
configmap/khays-lab14-kube-prometheu-cluster-total                       1      6m24s
configmap/khays-lab14-kube-prometheu-controller-manager                  1      6m24s
configmap/khays-lab14-kube-prometheu-etcd                                1      6m24s
configmap/khays-lab14-kube-prometheu-grafana-datasource                  1      6m24s
configmap/khays-lab14-kube-prometheu-grafana-overview                    1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-coredns                         1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-resources-cluster               1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-resources-multicluster          1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-resources-namespace             1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-resources-node                  1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-resources-pod                   1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-resources-workload              1      6m24s
configmap/khays-lab14-kube-prometheu-k8s-resources-workloads-namespace   1      6m24s
configmap/khays-lab14-kube-prometheu-kubelet                             1      6m24s
configmap/khays-lab14-kube-prometheu-namespace-by-pod                    1      6m24s
configmap/khays-lab14-kube-prometheu-namespace-by-workload               1      6m24s
configmap/khays-lab14-kube-prometheu-node-cluster-rsrc-use               1      6m24s
configmap/khays-lab14-kube-prometheu-node-rsrc-use                       1      6m24s
configmap/khays-lab14-kube-prometheu-nodes                               1      6m24s
configmap/khays-lab14-kube-prometheu-nodes-darwin                        1      6m24s
configmap/khays-lab14-kube-prometheu-persistentvolumesusage              1      6m24s
configmap/khays-lab14-kube-prometheu-pod-total                           1      6m24s
configmap/khays-lab14-kube-prometheu-prometheus                          1      6m24s
configmap/khays-lab14-kube-prometheu-proxy                               1      6m24s
configmap/khays-lab14-kube-prometheu-scheduler                           1      6m24s
configmap/khays-lab14-kube-prometheu-workload-total                      1      6m24s
configmap/kube-root-ca.crt                                               1      43d
configmap/prometheus-khays-lab14-kube-prometheu-prometheus-rulefiles-0   34     5m42s
```

---

## Grafana Dashboards

### Monitor the CPU and memory usage of your StatefulSet

![CPU and Memory](./img/1.png)

### Find the pods with elevated and reduced CPU usage within the default namespace

![Pods](./img/2.png)

### Track the node's memory usage in both percentage and megabytes

![Memory usage](./img/3.png)

### Assess the network usage of pods within the default namespace

![Network usage](./img/4.png)

### Find the active alert count and access the Web UI through `minikube service monitoring-kube-prometheus-alertmanager`

![Active alerts](./img/5.png)

---

## Init Container

Output of `kubectl exec pod/khays-deployment-0 -- cat /work-dir/index.html`:

```bash
Defaulted container "khays-deployment" out of: khays-deployment, install (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```
